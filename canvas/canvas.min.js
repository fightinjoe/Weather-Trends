var M=Math,sq75=M.sqrt(0.75);var C=function(b){var a=this;this.A={hex:null,tpl:null};var c=function(d){if(d.hex){a.A.hex=d.hex;a.A.tpl=a.toTriplet()}if(d.tpl){a.A.tpl=d.tpl;a.A.hex=a.toString()}};this.gradient=function(j,d){var g=a.A.tpl,f=j.A.tpl,l;l=function(m){return(f[m]-g[m])/d};var k=[l(0),l(1),l(2)];var e=[a];l=function(n,m){return g[m]+(k[m]*n)};for(var h=0;h<d;h++){e.push(new C({tpl:[l(h,0),l(h,1),l(h,2)]}))}return e};this.toTriplet=function(){function d(e){return parseInt(a.A.hex.substr(e,2),16)}return[d(0),d(2),d(4)]};this.toString=function(){var d=a.A.tpl,e;function f(g){e=M.floor(d[g]).toString(16);return(("0"+e).substr(e.length-1,2))}return f(0)+f(1)+f(2)};(function(){c(b)}())};var Temps=function(d){var o=this;this.A={width:30,x:null,y:null,canvas:null,per10:6,step:null,minTemp:-10,margin:10,m:1};function g(p){return new C({hex:p})}var j=[g("000"),g("9363F6"),g("FFF"),g("2CE7FC"),g("FEFB60"),g("FF001A"),g("8C0009")];var m=null;this.drawTemp=function(p){var r=f("step"),u=o.snap(p.min,"min"),x=o.snap(p.max,"max");off=(f("width")+f("margin"))*(p.offset+0.5);console.log([f("width"),f("margin"),p.offset]);var z=h(u,x),s=f("m");var w=s==1?o.getWidth(u,x,p.offset):off;var q=true,A=[null,null,{x:w,y:0}],y=x,t;for(var v=0;v<z;v++){t=(y<=o.snap(p.high,"max")&&y>=p.low)?"#"+c(y):null;A=q?i(A[2],t,s):e(A[2],t,s);q=!q;y=y-r}if(p.mark){for(var s in p.mark){s=p.mark[s];k({x:(o.degreeToPixel(s.temp-u)/sq75)/2+off-f("width")/1.5,y:o.degreeToPixel(x-s.temp)},s)}}};var c=function(p){return m[M.floor((p-f("minTemp"))/f("step"))]};var i=function(r,s,q,p){s=s||"#000000";p=p||f("x");q=q||1;var t=[r];t.push({x:r.x+q*p,y:r.y});t.push({x:r.x+q*(p/2),y:r.y+p*sq75});t.push(r);l(t,(typeof s=="object"?s:{fillStyle:s}));return t};var e=function(r,s,q,p){s=s||"#2A2A2A";p=p||f("x");q=q||1;var t=[r];t.push({x:r.x-q*(p/2),y:r.y-p*sq75});t.push({x:r.x-q*p,y:r.y});t.push(r);l(t,(typeof s=="object"?s:{fillStyle:s}));return t};var l=function(t,u){var s=f("canvas").getContext("2d"),p=t[0];u.shadowColor=u.shadowColor||"transparent";for(var r in u){s[r]=u[r]}s.beginPath();s.moveTo(p.x,p.y);for(var q=1;q<t.length;q++){p=t[q];s.lineTo(p.x,p.y)}s.fill();if(u.strokeStyle){s.stroke()}s.closePath()};var k=function(r,t){var v=t.m==-1?i:e;var s=20,u={},x={x:r.x+(t.m*s/3)+f("x")/2,y:(r.y+t.m*s*sq75/2)},y={strokeStyle:t.c,lineWidth:t.stroke,fillStyle:"transparent",shadowColor:"#555",shadowOffsetX:1,shadowOffsetY:1,shadowBlur:2};u.y=x.y-t.m*8;u.x=x.x+(t.m==1?-15:5);l([u,{x:0,y:u.y}],y);v(x,y,null,20)};this.getHeight=function(q,p){return o.getWidth(q,p)*2*sq75};this.getWidth=function(q,p,s){var r=M.floor(h(q,p)/2)*(f("width")/2);if(s){r=r+s*(f("width")+f("margin"))}return r};var h=function(q,p){return M.ceil((p-q)/f("step"))};this.snap=function(r,p){var q=f("step");return p=="min"?M.floor(r/q)*q:M.ceil(r/q)*q};this.degreeToPixel=function(p){return p*(f("y")/2*f("per10")/10)};var n=function(p){a("width",p.width,true);a("x",f("width")*1);a("y",f("width")*sq75);a("canvas",$(p.canvas)[0]);a("per10",p.per10,true);a("step",10/f("per10"));a("m",p.m,true);m=b()};var b=function(){var q=[],s=(f("per10")*2)-1,u,t;for(var r=1;r<j.length;r++){var p=j[r-1].gradient(j[r],s);q=q.concat(p)}q.push(j[j.length-1]);return q};var a=function(q,r,p){if(p&&!r){return}o.A[q]=r};var f=function(p){return o.A[p]};(function(){n(d)}())};var Chart=function(e,i,b){var k=this;this.A={low:null,high:null,temps:null,container:null,canvas:null,m:1};var j=function(r,n,q){q=q||{};var m=r[0].low,p=r[0].high;for(var o=0;o<r.length;o++){m=M.min(r[o].low,m);p=M.max(r[o].high,p)}a({low:m,high:p,min:M.floor(m/10)*10,max:M.ceil(p/10)*10,ts:e});a("m",q.m,true);c(n);f(r);d()};var c=function(v){var r=$("<canvas/>"),n=$("#"+(h("m")==1?"forecast":"cities")),x=$('<div class="wrapper "><div class="content"><h1>'+v+"</h1></div></div>").appendTo(n).append(r),y=new Temps({canvas:r,width:35,m:h("m")});a({wrap:x,canvas:r,temps:y});if(h("m")==-1){x.addClass("neg")}r.wrap('<div class="cWrapper"/>');var q=h("min"),s=h("max"),u=h("ts").length,m=y.getWidth(q,s)+y.A.width*u+y.A.margin*(u-1),o=y.getHeight(q,s);r[0].width=m;r[0].height=o;a({width:m,height:o})};var f=function(p){var u=$('<ul class="x"/>'),r=$('<ul class="y"/>'),v=h("width"),z,s,m;h("canvas").after(u).after(r);a({x:u,y:r});m=p.length;for(var o=0;o<m;o++){z=$("<li>"+p[o].label+"</li>").appendTo(u);h("m")==1?z.css({right:v-(45*o)-20}):z.css({left:v-(45*(p.length-o))+20})}var n=h("min"),q=h("max");for(var o=n;o<=q;o=o+10){z=$("<li>"+o+"&deg;</li>").appendTo(r);s=h("temps").degreeToPixel((o)-n);z.css("bottom",s+"px");z.css(h("m")==1?"left":"right",((p.length*45)+20+(s/sq75*0.5))+"px")}};var g=function(l){var m=$('<ul class="labels"/>').appendTo($(".cWrapper"));each(l,function(o){console.log(o);var n=$("<li>").appendTo(m).append(o.l);n.css("bottom",h("temps").degreeToPixel((o.t)-h("min"))+"px")})};var d=function(){var s=h("temps"),u=h("ts"),v=h("max"),q=h("min"),p=h("high"),m=h("low"),x=false,r=false;for(var o=0;o<u.length;o++){var w=u[o];var n=[];if(w.mark){n.push({temp:w.mark,m:1,stroke:3,c:"#FFF"})}if(!x&&p==w.high){n.push({temp:w.high,m:1,stroke:2,c:"#AAA"});x=true}if(!r&&m==w.low){n.push({temp:w.low,m:-1,stroke:2,c:"#AAA"});r=true}s.drawTemp({max:v,min:q,high:w.high,low:w.low,offset:o,mark:n})}g([{l:$("<em>Current Temp: <span>"+u[0].mark+"&deg;</span></em>"),t:u[0].mark},{l:$("<span>Weekly High: "+p+"&deg;</span>"),t:p},{l:$("<span>Weekly Low: "+m+"&deg;</span>"),t:m}])};var a=function(n,o,m){if(m&&!o){return}if(typeof n=="object"){for(var l in n){k.A[l]=n[l]}}else{k.A[n]=o;return o}};var h=function(l){return k.A[l]};(function(){j(e,i,b)}())};var YQL={api:"http://api.wunderground.com/auto/wui/geo/ForecastXML/index.xml?query=",url:"http://query.yahooapis.com/v1/public/yql?format=json&q=",query:"select * from xml where url",forecast:function(a){var b=YQL.url+escape(YQL.query+'="'+YQL.api+escape(a)+'"');YQL._query(b,"YQL.forecastCB")},cities:function(a){var d=[];for(var c in a){d.push(YQL.api+escape(a[c]))}var b=YQL.url+escape(YQL.query+' in ("'+d.join('","')+'")');YQL._query(b,"YQL.citiesCB")},forecastCB:function(d){var a=d.query.results.forecast,c;var e=a.txt_forecast.forecastday[0].fcttext;a=a.simpleforecast.forecastday;var g=[];for(var b in a){c=a[b];g.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(g,e)},citiesCB:function(d){var a=d.query.results.forecast,e=[],c;for(var b in a){c=a[b].simpleforecast.forecastday[0];e.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(e,"text",{m:-1})},_forecastCollector:function(a){return{label:a.date.weekday,high:a.high.fahrenheit,low:a.low.fahrenheit}},_query:function(b,a){$.ajax({url:b,dataType:"jsonp",jsonp:"callback",jsonpCallback:a})}};String.prototype.titleCase=function(){var b=this.split(" ");for(var a in b){b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1,-1)}return b.join(" ")};var each=function(a,c){for(var b=0;b<a.length;b++){c(a[b],b)}};