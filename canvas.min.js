var M=Math,sq75=M.sqrt(0.75);var Color=function(a){var b=this;this.A={hex:null,triplet:null};var c=function(d){if(d.hex){b.A.hex=d.hex;b.A.triplet=b.toTriplet()}if(d.triplet){b.A.triplet=d.triplet;b.A.hex=b.toString()}};this.gradient=function(j,d){var g=b.A.triplet,f=j.A.triplet;var k=[(f[0]-g[0])/d,(f[1]-g[1])/d,(f[2]-g[2])/d];var e=[b];for(var h=0;h<d;h++){e.push(new Color({triplet:[g[0]+(k[0]*h),g[1]+(k[1]*h),g[2]+(k[2]*h)]}))}return e};this.toTriplet=function(){return[parseInt(b.A.hex.substr(0,2),16),parseInt(b.A.hex.substr(2,2),16),parseInt(b.A.hex.substr(4,2),16)]};this.toString=function(){var d=b.A.triplet,e;function f(g){e=M.floor(d[g]).toString(16);return(("0"+e).substr(e.length-1,2))}return f(0)+f(1)+f(2)};(function(){c(a)}())};var Temps=function(b){var m=this;this.A={width:30,x:null,y:null,canvas:null,per10:6,step:null,minTemp:-10,margin:10};var g=[new Color({hex:"000000"}),new Color({hex:"9363F6"}),new Color({hex:"FFFFFF"}),new Color({hex:"2CE7FC"}),new Color({hex:"FEFB60"}),new Color({hex:"FF001A"}),new Color({hex:"8C0009"})];var j=null;this.drawTemp=function(n){var p=d("step"),r=m.snap(n.min,"min"),u=m.snap(n.max,"max");var w=e(r,u);var t=m.getWidth(r,u,n.offset);var o=true,x=[null,null,{x:t,y:0}],v=u,q;for(var s=0;s<w;s++){q=(v<=m.snap(n.high,"max")&&v>=n.low)?"#"+k(v):null;x=o?f(x[2],q):c(x[2],q);o=!o;v=v-p}};var k=function(n){return j[M.floor((n-d("minTemp"))/d("step"))]};var f=function(n,o){o=o||"#000000";var p=[n];p.push({x:n.x+d("x"),y:n.y});p.push({x:n.x+(d("x")/2),y:n.y+d("y")});p.push(n);i(p,{fillStyle:o});return p};var c=function(n,o){o=o||"#2A2A2A";var p=[n];p.push({x:n.x-(d("x")/2),y:n.y-d("y")});p.push({x:n.x-d("x"),y:n.y});p.push(n);i(p,{fillStyle:o});return p};var i=function(r,s){var q=d("canvas").getContext("2d"),n=r[0];for(var p in s){q[p]=s[p]}q.beginPath();q.moveTo(n.x,n.y);for(var o=1;o<r.length;o++){n=r[o];q.lineTo(n.x,n.y)}q.fill();if(s.strokeStyle){q.stroke()}q.closePath()};this.getHeight=function(o,n){return m.getWidth(o,n)*2*sq75};this.getWidth=function(o,n,q){var p=M.floor(e(o,n)/2)*(d("width")/2);if(q){p=p+q*(d("width")+d("margin"))}return p};var e=function(o,n){return M.ceil((n-o)/d("step"))};this.snap=function(p,n){var o=d("step");return n=="min"?M.floor(p/o)*o:M.ceil(p/o)*o};this.degreeToPixel=function(n){return n*((d("width")*sq75/2)*d("per10")/10)};var l=function(n){a("width",n.width,true);a("x",d("width")*1);a("y",d("width")*sq75);a("canvas",$(n.canvas)[0]);a("per10",n.per10,true);a("step",10/d("per10"));j=h()};var h=function(){var o=[],q=(d("per10")*2)-1,s,r;for(var p=1;p<g.length;p++){var n=g[p-1].gradient(g[p],q);o=o.concat(n)}o.push(g[g.length-1]);return o};var a=function(o,p,n){if(n&&!p){return}m.A[o]=p};var d=function(n){return m.A[n]};(function(){l(b)}())};var Chart=function(h){var f=this;this.A={low:null,high:null,temps:null,container:null,canvas:null};var g=function(o,k){var j=o[0].low,n=o[0].high;for(var m=0;m<o.length;m++){j=M.min(o[m].low,j);n=M.max(o[m].high,n)}a({low:j,high:n,min:M.floor(j/10)*10,max:M.ceil(n/10)*10,ts:h});c(k);d(o);e()};var c=function(p){var m=$("<canvas/>"),q=$('<div class="wrapper"><div class="content"><h1>'+p+"</h1></div></div>").appendTo($("body")).append(m),r=new Temps({canvas:m,width:35});a({wrap:q,canvas:m,temps:r});m.wrap('<div class="cWrapper"/>');var k=b("min"),n=b("max"),o=b("ts").length,i=r.getWidth(k,n)+r.A.width*o+r.A.margin*(o-1),j=r.getHeight(k,n);m[0].width=i;m[0].height=j;a({width:i,height:j})};var d=function(n){var r=$('<ul class="x"/>'),p=$('<ul class="y"/>'),s=b("width"),u,q,j;canvas=b("canvas");canvas.after(r).after(p);a({x:r,y:p});j=n.length;for(var m=0;m<j;m++){u=$("<li>"+n[m].label+"</li>").appendTo(r);u.css({right:s-(45*m)-20})}var k=b("min"),o=b("max");for(var m=k;m<=o;m=m+10){u=$("<li>"+m+"&deg;</li>").appendTo(p);q=b("temps").degreeToPixel((m)-k);u.css({bottom:q+"px",left:((n.length*45)+20+(q/sq75*0.5))+"px"})}};var e=function(){var l=b("temps"),m=b("ts"),n=b("max"),j=b("min");for(var k=0;k<m.length;k++){l.drawTemp({max:n,min:j,high:m[k].high,low:m[k].low,offset:k})}};var a=function(l,m,j){if(j&&!m){return}if(typeof l=="object"){for(var i in l){f.A[i]=l[i]}}else{f.A[l]=m;return m}};var b=function(i){return f.A[i]};(function(){g(h)}())};var YQL={url:"http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D%22http%3A%2F%2Fapi.wunderground.com%2Fauto%2Fwui%2Fgeo%2FForecastXML%2Findex.xml%3Fquery%3D__L__%22&format=json",weather:function(b,a){var c=YQL.url.replace("__L__",escape(encodeURIComponent(b)));YQL._query(c,a?"YQL.weatherCBf":"YQL.weatherCBc")},weatherCBf:function(d){var a=d.query.results.forecast,c;var e=a.txt_forecast.forecastday[0].fcttext;a=a.simpleforecast.forecastday;var g=[];for(var b in a){c=a[b];g.push({label:c.date.weekday,high:c.high.fahrenheit,low:c.low.fahrenheit})}$(".wrapper").remove();new Chart(g,e)},_query:function(b,a){console.log(a);$.ajax({url:b,dataType:"jsonp",jsonp:"callback",jsonpCallback:a})}};