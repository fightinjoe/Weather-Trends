var M=Math,sq75=M.sqrt(0.75);var C=function(b){var a=this;this.A={hex:null,tpl:null};var c=function(d){if(d.hex){a.A.hex=d.hex;a.A.tpl=a.toTriplet()}if(d.tpl){a.A.tpl=d.tpl;a.A.hex=a.toString()}};this.gradient=function(j,d){var g=a.A.tpl,f=j.A.tpl,l;l=function(m){return(f[m]-g[m])/d};var k=[l(0),l(1),l(2)];var e=[a];l=function(n,m){return g[m]+(k[m]*n)};for(var h=0;h<d;h++){e.push(new C({tpl:[l(h,0),l(h,1),l(h,2)]}))}return e};this.toTriplet=function(){function d(e){return parseInt(a.A.hex.substr(e,2),16)}return[d(0),d(2),d(4)]};this.toString=function(){var d=a.A.tpl,e;function f(g){e=M.floor(d[g]).toString(16);return(("0"+e).substr(e.length-1,2))}return f(0)+f(1)+f(2)};(function(){c(b)}())};var Temps=function(d){var o=this;this.A={width:30,x:null,y:null,canvas:null,per10:6,step:null,minTemp:-10,margin:10,m:1};function g(p){return new C({hex:p})}var j=[g("000"),g("9363F6"),g("FFF"),g("2CE7FC"),g("FEFB60"),g("FF001A"),g("8C0009")];var m=null;this.drawTemp=function(p){var r=f("step"),u=o.snap(p.min,"min"),x=o.snap(p.max,"max");var z=h(u,x),s=f("m");var w=s==1?o.getWidth(u,x,p.offset):(f("width")+f("margin"))*(p.offset+0.5);var q=true,A=[null,null,{x:w,y:0}],y=x,t;for(var v=0;v<z;v++){t=(y<=o.snap(p.high,"max")&&y>=p.low)?"#"+c(y):null;A=q?i(A[2],t,s):e(A[2],t,s);q=!q;y=y-r}if(p.mark){k({x:(o.degreeToPixel(p.mark-u)/sq75)/2,y:o.degreeToPixel(x-p.mark)},p.markDown)}};var c=function(p){return m[M.floor((p-f("minTemp"))/f("step"))]};var i=function(r,s,q,p){s=s||"#000000";p=p||f("x");q=q||1;var t=[r];t.push({x:r.x+q*p,y:r.y});t.push({x:r.x+q*(p/2),y:r.y+f("y")});t.push(r);l(t,(typeof s=="object"?s:{fillStyle:s}));return t};var e=function(r,s,q,p){s=s||"#2A2A2A";p=p||f("x");q=q||1;var t=[r];t.push({x:r.x-q*(p/2),y:r.y-p*sq75});t.push({x:r.x-q*p,y:r.y});t.push(r);l(t,(typeof s=="object"?s:{fillStyle:s}));return t};var l=function(t,u){var s=f("canvas").getContext("2d"),p=t[0];for(var r in u){s[r]=u[r]}s.beginPath();s.moveTo(p.x,p.y);for(var q=1;q<t.length;q++){p=t[q];s.lineTo(p.x,p.y)}s.fill();if(u.strokeStyle){s.stroke()}s.closePath()};var k=function(p,s){var r=s?i:e;var q=20;r({x:p.x+q/3+f("x")/2,y:(p.y+q*sq75/2)},{strokeStyle:"#FFF",lineWidth:3,fillStyle:"transparent"},null,20)};this.getHeight=function(q,p){return o.getWidth(q,p)*2*sq75};this.getWidth=function(q,p,s){var r=M.floor(h(q,p)/2)*(f("width")/2);if(s){r=r+s*(f("width")+f("margin"))}return r};var h=function(q,p){return M.ceil((p-q)/f("step"))};this.snap=function(r,p){var q=f("step");return p=="min"?M.floor(r/q)*q:M.ceil(r/q)*q};this.degreeToPixel=function(p){return p*(f("y")/2*f("per10")/10)};var n=function(p){a("width",p.width,true);a("x",f("width")*1);a("y",f("width")*sq75);a("canvas",$(p.canvas)[0]);a("per10",p.per10,true);a("step",10/f("per10"));a("m",p.m,true);m=b()};var b=function(){var q=[],s=(f("per10")*2)-1,u,t;for(var r=1;r<j.length;r++){var p=j[r-1].gradient(j[r],s);q=q.concat(p)}q.push(j[j.length-1]);return q};var a=function(q,r,p){if(p&&!r){return}o.A[q]=r};var f=function(p){return o.A[p]};(function(){n(d)}())};var Chart=function(e,h,b){var j=this;this.A={low:null,high:null,temps:null,container:null,canvas:null,m:1};var i=function(q,m,p){p=p||{};var k=q[0].low,o=q[0].high;for(var n=0;n<q.length;n++){k=M.min(q[n].low,k);o=M.max(q[n].high,o)}a({low:k,high:o,min:M.floor(k/10)*10,max:M.ceil(o/10)*10,ts:e});a("m",p.m,true);c(m);f(q);d()};var c=function(u){var q=$("<canvas/>"),m=$("#"+(g("m")==1?"forecast":"cities")),v=$('<div class="wrapper "><div class="content"><h1>'+u+"</h1></div></div>").appendTo(m).append(q),x=new Temps({canvas:q,width:35,m:g("m")});a({wrap:v,canvas:q,temps:x});if(g("m")==-1){v.addClass("neg")}q.wrap('<div class="cWrapper"/>');var o=g("min"),r=g("max"),s=g("ts").length,k=x.getWidth(o,r)+x.A.width*s+x.A.margin*(s-1),n=x.getHeight(o,r);q[0].width=k;q[0].height=n;a({width:k,height:n})};var f=function(o){var s=$('<ul class="x"/>'),q=$('<ul class="y"/>'),u=g("width"),v,r,k;canvas=g("canvas");canvas.after(s).after(q);a({x:s,y:q});k=o.length;for(var n=0;n<k;n++){v=$("<li>"+o[n].label+"</li>").appendTo(s);g("m")==1?v.css({right:u-(45*n)-20}):v.css({left:u-(45*(o.length-n))+20})}var m=g("min"),p=g("max");for(var n=m;n<=p;n=n+10){v=$("<li>"+n+"&deg;</li>").appendTo(q);r=g("temps").degreeToPixel((n)-m);v.css("bottom",r+"px");v.css(g("m")==1?"left":"right",((o.length*45)+20+(r/sq75*0.5))+"px")}};var d=function(){var m=g("temps"),n=g("ts"),o=g("max"),k=g("min");for(var l=0;l<n.length;l++){m.drawTemp({max:o,min:k,high:n[l].high,low:n[l].low,offset:l,mark:n[l].mark})}};var a=function(n,o,m){if(m&&!o){return}if(typeof n=="object"){for(var l in n){j.A[l]=n[l]}}else{j.A[n]=o;return o}};var g=function(k){return j.A[k]};(function(){i(e,h,b)}())};var YQL={api:"http://api.wunderground.com/auto/wui/geo/ForecastXML/index.xml?query=",url:"http://query.yahooapis.com/v1/public/yql?format=json&q=",query:"select * from xml where url",forecast:function(a){var b=YQL.url+escape(YQL.query+'="'+YQL.api+escape(a)+'"');YQL._query(b,"YQL.forecastCB")},cities:function(a){var d=[];for(var c in a){d.push(YQL.api+escape(a[c]))}var b=YQL.url+escape(YQL.query+' in ("'+d.join('","')+'")');YQL._query(b,"YQL.citiesCB")},forecastCB:function(d){var a=d.query.results.forecast,c;var e=a.txt_forecast.forecastday[0].fcttext;a=a.simpleforecast.forecastday;var g=[];for(var b in a){c=a[b];g.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(g,e)},citiesCB:function(d){var a=d.query.results.forecast,e=[],c;for(var b in a){c=a[b].simpleforecast.forecastday[0];e.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(e,"text",{m:-1})},_forecastCollector:function(a){return{label:a.date.weekday,high:a.high.fahrenheit,low:a.low.fahrenheit}},_query:function(b,a){$.ajax({url:b,dataType:"jsonp",jsonp:"callback",jsonpCallback:a})}};String.prototype.titleCase=function(){var b=this.split(" ");for(var a in b){b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1,-1)}return b.join(" ")};