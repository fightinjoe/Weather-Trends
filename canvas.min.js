var M=Math,sq75=M.sqrt(0.75);var C=function(b){var a=this;this.A={hex:null,tpl:null};var c=function(d){if(d.hex){a.A.hex=d.hex;a.A.tpl=a.toTriplet()}if(d.tpl){a.A.tpl=d.tpl;a.A.hex=a.toString()}};this.gradient=function(j,d){var g=a.A.tpl,f=j.A.tpl,l;l=function(m){return(f[m]-g[m])/d};var k=[l(0),l(1),l(2)];var e=[a];l=function(n,m){return g[m]+(k[m]*n)};for(var h=0;h<d;h++){e.push(new C({tpl:[l(h,0),l(h,1),l(h,2)]}))}return e};this.toTriplet=function(){function d(e){return parseInt(a.A.hex.substr(e,2),16)}return[d(0),d(2),d(4)]};this.toString=function(){var d=a.A.tpl,e;function f(g){e=M.floor(d[g]).toString(16);return(("0"+e).substr(e.length-1,2))}return f(0)+f(1)+f(2)};(function(){c(b)}())};var Temps=function(c){var n=this;this.A={width:30,x:null,y:null,canvas:null,per10:6,step:null,minTemp:-10,margin:10,m:1};function g(o){return new C({hex:o})}var j=[g("000"),g("9363F6"),g("FFF"),g("2CE7FC"),g("FEFB60"),g("FF001A"),g("8C0009")];var l=null;this.drawTemp=function(o){var q=f("step"),t=n.snap(o.min,"min"),w=n.snap(o.max,"max");var y=h(t,w),r=f("m");var v=r==1?n.getWidth(t,w,o.offset):(f("width")+f("margin"))*(o.offset+0.5);var p=true,z=[null,null,{x:v,y:0}],x=w,s;for(var u=0;u<y;u++){s=(x<=n.snap(o.high,"max")&&x>=o.low)?"#"+b(x):null;z=p?i(z[2],s,r):e(z[2],s,r);p=!p;x=x-q}};var b=function(o){return l[M.floor((o-f("minTemp"))/f("step"))]};var i=function(p,q,o){q=q||"#000000";o=o||1;var r=[p];r.push({x:p.x+o*f("x"),y:p.y});r.push({x:p.x+o*(f("x")/2),y:p.y+f("y")});r.push(p);k(r,{fillStyle:q});return r};var e=function(p,q,o){q=q||"#2A2A2A";o=o||1;var r=[p];r.push({x:p.x-o*(f("x")/2),y:p.y-f("y")});r.push({x:p.x-o*f("x"),y:p.y});r.push(p);k(r,{fillStyle:q});return r};var k=function(s,t){var r=f("canvas").getContext("2d"),o=s[0];for(var q in t){r[q]=t[q]}r.beginPath();r.moveTo(o.x,o.y);for(var p=1;p<s.length;p++){o=s[p];r.lineTo(o.x,o.y)}r.fill();if(t.strokeStyle){r.stroke()}r.closePath()};this.getHeight=function(p,o){return n.getWidth(p,o)*2*sq75};this.getWidth=function(p,o,r){var q=M.floor(h(p,o)/2)*(f("width")/2);if(r){q=q+r*(f("width")+f("margin"))}return q};var h=function(p,o){return M.ceil((o-p)/f("step"))};this.snap=function(q,o){var p=f("step");return o=="min"?M.floor(q/p)*p:M.ceil(q/p)*p};this.degreeToPixel=function(o){return o*((f("width")*sq75/2)*f("per10")/10)};var m=function(o){d("width",o.width,true);d("x",f("width")*1);d("y",f("width")*sq75);d("canvas",$(o.canvas)[0]);d("per10",o.per10,true);d("step",10/f("per10"));d("m",o.m,true);l=a()};var a=function(){var p=[],r=(f("per10")*2)-1,t,s;for(var q=1;q<j.length;q++){var o=j[q-1].gradient(j[q],r);p=p.concat(o)}p.push(j[j.length-1]);return p};var d=function(p,q,o){if(o&&!q){return}n.A[p]=q};var f=function(o){return n.A[o]};(function(){m(c)}())};var Chart=function(h){var b=this;this.A={low:null,high:null,temps:null,container:null,canvas:null,m:-1};var g=function(o,k){var j=o[0].low,n=o[0].high;for(var m=0;m<o.length;m++){j=M.min(o[m].low,j);n=M.max(o[m].high,n)}a({low:j,high:n,min:M.floor(j/10)*10,max:M.ceil(n/10)*10,ts:h});d(k);e(o);f()};var d=function(p){var m=$("<canvas/>"),q=$('<div class="wrapper "><div class="content"><h1>'+p+"</h1></div></div>").appendTo($("body")).append(m),r=new Temps({canvas:m,width:35,m:c("m")});a({wrap:q,canvas:m,temps:r});if(c("m")==-1){q.addClass("neg")}m.wrap('<div class="cWrapper"/>');var k=c("min"),n=c("max"),o=c("ts").length,i=r.getWidth(k,n)+r.A.width*o+r.A.margin*(o-1),j=r.getHeight(k,n);m[0].width=i;m[0].height=j;a({width:i,height:j})};var e=function(n){var r=$('<ul class="x"/>'),p=$('<ul class="y"/>'),s=c("width"),u,q,j;canvas=c("canvas");canvas.after(r).after(p);a({x:r,y:p});j=n.length;for(var m=0;m<j;m++){u=$("<li>"+n[m].label+"</li>").appendTo(r);c("m")==1?u.css({right:s-(45*m)-20}):u.css({left:s-(45*(n.length-m))+20})}var k=c("min"),o=c("max");for(var m=k;m<=o;m=m+10){u=$("<li>"+m+"&deg;</li>").appendTo(p);q=c("temps").degreeToPixel((m)-k);u.css("bottom",q+"px");u.css(c("m")==1?"left":"right",((n.length*45)+20+(q/sq75*0.5))+"px")}};var f=function(){var l=c("temps"),m=c("ts"),n=c("max"),j=c("min");for(var k=0;k<m.length;k++){l.drawTemp({max:n,min:j,high:m[k].high,low:m[k].low,offset:k})}};var a=function(l,m,j){if(j&&!m){return}if(typeof l=="object"){for(var i in l){b.A[i]=l[i]}}else{b.A[l]=m;return m}};var c=function(i){return b.A[i]};(function(){g(h)}())};var YQL={api:"http://api.wunderground.com/auto/wui/geo/ForecastXML/index.xml?query=",url:"http://query.yahooapis.com/v1/public/yql?format=json&q=",query:"select * from xml where url",forecast:function(a){var b=YQL.url+escape(YQL.query+'="'+escape(YQL.api+a)+'"');YQL._query(b,"YQL.weatherCB")},cities:function(a){var d=[];for(var c in a){d.push(YQL.api+escape(a[c]))}var b=YQL.url+escape(YQL.query+' in ("'+d.join('","')+'")');YQL._query(b,"YQL.citiesCB")},forecastCB:function(d){var a=d.query.results.forecast,c;var e=a.txt_forecast.forecastday[0].fcttext;a=a.simpleforecast.forecastday;var g=[];for(var b in a){c=a[b];g.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(g,e)},citiesCB:function(d){var a=d.query.results.forecast,e=[],c;for(var b in a){c=a[b].simpleforecast.forecastday[0];e.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(e,"text")},_forecastCollector:function(a){return{label:a.date.weekday,high:a.high.fahrenheit,low:a.low.fahrenheit}},_query:function(b,a){console.log(a);$.ajax({url:b,dataType:"jsonp",jsonp:"callback",jsonpCallback:a})}};