var M=Math,r=8.66;var R,W,G,T,TX,B;function glob(){R=x("r"),W=x("w"),G=x("g"),T=x("t"),TX=x("txt")}var xs={_A:function(a){this.appendChild(a);return this},prepend:function(a){this.insertBefore(a,this.firstChild);return this},dad:function(){return x(this.parentNode)},clone:function(){var a=this.cloneNode(false),c=this.childNodes;a.id=null;a=x(a);for(var b=0;b<c.length;b++){a._A(x(c[b]).clone())}return a},attr:function(b,d){var c=["fill-opacity","filter"].indexOf(b)>-1;if(typeof b=="object"){for(var a in b){this.attr(a,b[a])}}else{if(arguments.length==2){this.setAttributeNS(null,b,d)}else{return this.getAttributeNS(null,b)}}return this},trans:function(b){var a=Array.prototype;t=(this.attr("transform")||"").replace(new RegExp(b+"\\(.*?\\)"),"");var c=t+" "+b+"("+a.join.call(a.slice.call(arguments,1)," ")+")";this.attr("transform",c);return this},move:function(a,b){return this.trans("translate",a,b)},turn:function(b,a,c){return this.trans("rotate",b,a,c)},bg:function(a){return this.attr("fill",a.toString())},text:function(a){this.appendChild(document.createTextNode(a));return this},empty:function(){var a=this.childNodes;while(a.length>0){this.removeChild(a[0])}},};var x=function(b){if(typeof b=="string"){return x(document.getElementById(b))}else{for(var a in xs){b[a]=xs[a]}return b}};var C=function(b){var a=this;this.A={hex:null,tpl:null};var c=function(d){if(d.hex){a.A.hex=d.hex;a.A.tpl=a.toTriplet()}if(d.tpl){a.A.tpl=d.tpl;a.A.hex=a.toString()}};this.gradient=function(k,d){var g=a.A.tpl,f=k.A.tpl,m;m=function(n){return(f[n]-g[n])/d};var l=[m(0),m(1),m(2)];var e=[a];m=function(o,n){return g[n]+(l[n]*o)};for(var j=0;j<d;j++){e.push(new C({tpl:[m(j,0),m(j,1),m(j,2)]}))}return e};this.toTriplet=function(){function d(e){return parseInt(a.A.hex.substr(e,2),16)}return[d(0),d(2),d(4)]};this.toString=function(){var d=a.A.tpl,e;function f(g){e=M.floor(d[g]).toString(16);return(("0"+e).substr(e.length-1,2))}return"#"+f(0)+f(1)+f(2)};(function(){c(b)}())};C.array=function(f,a){var j=new C({hex:f[0]}),b=[],g;for(var e=1;e<f.length;e++){if(g){j=g}g=new C({hex:f[e]});b=b.concat(j.gradient(g,a-1))}b.push(g);return b};C.bw=["#000","#2A2A2A"];var _GRADIENTS=C.array(["000000","9363F6","FFFFFF","2CE7FC","FEFB60","FF001A","8C0009"],12);var Temp=function(d,c){var b=this;b.A={o:1};var e=function(j,i){b.A.opts=j;b.A.low=f(j.low,-1);b.A.high=f(j.high,1);if(j.mark){b.A.cur=f(j.mark,1)}var g=f(j.min||j.low,-1,10);var k=f(j.max||j.high,1,10);while(k-g<40){k>=100?g=g-10:k=k+10}b.A.off=(j.off||0)*16;b.A.levels={d:(k-g)/10*3,h:(k-b.A.high)/10*6,l:(k-b.A.low)/10*6-1};if(j.mark){b.A.levels.c=M.floor((k-b.A.cur)/10*3)}b.A.label=i;b.A.min=g;b.A.max=k;b.A.cI=(g)*0.6+16;a(j.label,j.axis)};var f=function(j,g,i){i=i||10/6;j=j/i;return(g>0?M.ceil(j):M.floor(j))*i};var a=function(A,m){var E=G.clone();W._A(E);if(b.A.off){E.move(b.A.off,0)}E._offset=b.A.off;E._f4="high "+b.A.opts.high+"\u00B0, low "+b.A.opts.low+"\u00B0";var u=G.clone(),o=T.clone().move(5,0).turn(180,5,r/2),z=T.clone(),F=b.A.levels,D=F.d,s,y,q,n,l,p;u._A(o)._A(z);for(var v=0;v<D;v++){l=u.clone();E._A(l);l._offset=(D-v-1)*5;l.move(l._offset,r*v);s=D-2*v+b.A.cI;for(q=0;q<2;q++){p=(F.h<=v*2+q&&v*2+q<=F.l);l.childNodes[q].bg(p?_GRADIENTS[s-q]:C.bw[q]);if(!p){l.childNodes[q].attr("class","black")}}if(b.A.levels.c==v){l.attr("id","cur")}if(m&&(v%3==2)){y=TX.clone();y.text((b.A.max-(v+1)/3*10)+"\u00B0").move(15,r);l._A(y)}if(v==D-1&&b.A.label){y=TX.clone();y.text(b.A.label);l._A(y.move(-10,10).turn(-60,0,0).attr({"font-size":"10px","font-style":"italic"}))}}var w=E.clone();W.prepend(w);E.attr("class","temp");tx=TX.clone();tx.text(A).attr("text-anchor","end").turn(300,0,0).move(-8,10);l._A(tx)};(function(){e(d,c)}())};var chart=function(s,m){var v,A,y=s[0].low,D=s[0].high;for(A=0;A<s.length;A++){y=M.min(y,s[A].low);D=M.max(D,s[A].high)}for(A=0;A<s.length;A++){v=s[A];v.off=A;v.min=y;v.max=D;if(A==s.length-1){v.axis=true}new Temp(v,A==0?m:null)}try{var n=R.clone(),u=x(n.firstChild),d=x(n.childNodes[1]),k=d.clone(),c=x("cur"),e=W.getBBox(),w=e.width-(M.abs(e.x)-16+c._offset);u.attr("transform","scale(0.8)");n.attr("transform","scale(0.8)");c._A(u.move(-2,1)).prepend(n.move(-2,1));d.attr("width",w);n._A(k.move(w-0.2,0).attr({style:"fill:url(#gr)",width:40}));var q=TX.clone().text("currently "+s[0].mark+"\u00B0");n._A(q.move(w+20,7).attr({"font-size":"10","font-style":"italic"}));var b=document.getElementsByClassName("temp"),g;for(var A=0;A<b.length;A++){g=b[A].getElementsByClassName("black");for(var z=0;z<g.length;z++){x(g[z]).attr("style","display:none")}}var E=x(c.parentNode),a=TX.clone().text(E._f4);n._A(a.move(n.getBBox().width-4,14).attr("fill","Gray").attr("text-anchor","end"))}catch(f){}};var Y={api:"http://api.wunderground.com/auto/wui/geo/",svcF:"ForecastXML",svcC:"WXCurrentObXML",url:"http://query.yahooapis.com/v1/public/yql?diagnostics=true&format=json&q=",query:"select * from xml where url",p:"/index.xml?query=",f4:function(a){var d=Y.api+Y.svcF+Y.p+escape(a),c=d.replace(Y.svcF,Y.svcC);var b=Y.url+escape(Y.query+' in("'+[d,c].join('","')+'")');Y._query(b,"svg.Y.f4CB")},cities:function(a){var d=[];for(var c in a){d.push(Y.api+Y.svcF+Y.p+escape(a[c]))}var b=Y.url+escape(Y.query+' in ("'+d.join('","')+'")');Y._query(b,"svg.Y.citiesCB")},f4CB:function(c){var k=c.query.results,e=k.forecast,l=k.current_observation,g,d,j;var m=tCase(unescape(c.query.diagnostics.url[0].content).split("=")[1]);e=e.simpleforecast.forecastday;var a=[];for(var b in e){g=e[b];a.push(Y._f4C(g))}a[0].mark=parseInt(l.temp_f);W.empty();PW.set("w",m);chart(a,m);PW.$(".show").removeClass("show")},citiesCB:function(d){var a=d.query.results.forecast,g=[],c,e;for(var b in a){c=a[b].simpleforecast.forecastday[0];h=Y._f4C(c);e=PW.cz();h.label=e[b];g.push(h)}$(".wrapper").remove();W.empty();chart(g,"Multi-city");PW.$(".show").removeClass("show")},_f4C:function(a){return{label:a.date.weekday,high:a.high.fahrenheit,low:a.low.fahrenheit}},_query:function(b,a){$.ajax({url:b,dataType:"jsonp",jsonp:"callback",jsonpCallback:a})}};tCase=function(b){var b=b.split(" ");for(var a in b){b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1).toLowerCase()}return b.join(" ")};