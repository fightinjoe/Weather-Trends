var M=Math,r=8.66;var xs={append:function(a){this.appendChild(a);return this},prepend:function(a){this.insertBefore(a,this.firstChild);return this},dad:function(){return x(this.parentNode)},clone:function(){var a=this.cloneNode(false),c=this.childNodes;a.id=null;a=x(a);for(var b=0;b<c.length;b++){a.append(x(c[b]).clone())}return a},attr:function(b,d){var c=["fill-opacity","filter"].indexOf(b)>-1;if(typeof b=="object"){for(var a in b){this.attr(a,b[a])}}else{if(arguments.length==2){if(c){return this.stile(b,d)}this.setAttributeNS(null,b,d)}else{return c?this.stile(b):this.getAttributeNS(null,b)}}return this},stile:function(c,e){var b=this.attr("style"),d=new RegExp("(^| )\\s*"+c+"\\s*:\\s*([^;]+);( |$)");if(typeof c=="object"){for(var a in c){this.stile(a,c[a])}}else{if(arguments.length==2){b=b.replace(d," ")+" ";this.attr("style",b+c+":"+e+";")}else{return b.match(d)[2]}}},trans:function(b){var a=Array.prototype;t=(this.attr("transform")||"").replace(new RegExp(b+"\\(.*?\\)"),"");var c=t+" "+b+"("+a.join.call(a.slice.call(arguments,1)," ")+")";this.attr("transform",c);return this},move:function(a,b){return this.trans("translate",a,b)},turn:function(b,a,c){return this.trans("rotate",b,a,c)},bg:function(a){return this.attr("fill",a.toString())},text:function(a){this.appendChild(document.createTextNode(a));return this},animate:function(a,d,h){h=h||function(){};var e=1000,g=parseFloat(this.attr(a)),f=d-g,i=this,b;var c=function(){var k=Date.now();if(k>b+e){return h(i)}var j=f*(k-b)/e+g;i.attr(a,j);setTimeout(c,10)};b=Date.now();return c(Date.now())},};var x=function(b){if(typeof b=="string"){return x(document.getElementById(b))}else{for(var a in xs){b[a]=xs[a]}return b}};var C=function(b){var a=this;this.A={hex:null,tpl:null};var c=function(d){if(d.hex){a.A.hex=d.hex;a.A.tpl=a.toTriplet()}if(d.tpl){a.A.tpl=d.tpl;a.A.hex=a.toString()}};this.gradient=function(j,d){var g=a.A.tpl,f=j.A.tpl,l;l=function(m){return(f[m]-g[m])/d};var k=[l(0),l(1),l(2)];var e=[a];l=function(n,m){return g[m]+(k[m]*n)};for(var h=0;h<d;h++){e.push(new C({tpl:[l(h,0),l(h,1),l(h,2)]}))}return e};this.toTriplet=function(){function d(e){return parseInt(a.A.hex.substr(e,2),16)}return[d(0),d(2),d(4)]};this.toString=function(){var d=a.A.tpl,e;function f(g){e=M.floor(d[g]).toString(16);return(("0"+e).substr(e.length-1,2))}return"#"+f(0)+f(1)+f(2)};(function(){c(b)}())};C.array=function(f,a){var h=new C({hex:f[0]}),b=[],g;for(var e=1;e<f.length;e++){if(g){h=g}g=new C({hex:f[e]});b=b.concat(h.gradient(g,a-1))}b.push(g);return b};var _GRADIENTS=C.array(["000000","9363F6","FFFFFF","2CE7FC","FEFB60","FF001A","8C0009"],12);var Temp=function(d,c){var b=this;b.A={o:1};var e=function(h,g){b.A.low=f(h.low,-1);b.A.high=f(h.high,1);if(h.mark){b.A.cur=f(h.mark,1)}b.A.min=f(h.min||h.low,-1,10);b.A.max=f(h.max||h.high,1,10);b.A.off=(h.off||0)*16;b.A.levels={d:(b.A.max-b.A.min)/10*3,h:(b.A.max-b.A.high)/10*6,l:(b.A.max-b.A.low)/10*6-1};if(h.mark){b.A.levels.c=M.floor((b.A.max-b.A.cur)/10*3)}b.A.label=g;b.A.cI=(b.A.min)*0.6+16;a(h.label,h.axis)};var f=function(i,g,h){h=h||10/6;i=i/h;return(g>0?M.ceil(i):M.floor(i))*h};var a=function(A,h){var B=x("w"),y=x("g"),E=x("t"),s=x("txt");var D=y.clone();B.append(D);if(b.A.off){D.move(b.A.off,0)}D._offset=b.A.off;var o=y.clone(),v=E.clone().move(5,0).turn(180,5,r/2),u=E.clone(),n=b.A.levels,z=n.d,m,p,k;o.append(v).append(u);for(var q=0;q<z;q++){m=o.clone();D.append(m);m._offset=(z-q-1)*5;m.move(m._offset,r*q);p=z-2*q+b.A.cI;m.childNodes[0].bg((n.h<=q*2&&q*2<=n.l)?_GRADIENTS[p]:"#000");m.childNodes[1].bg((n.h<=q*2+1&&q*2+1<=n.l)?_GRADIENTS[p-1]:"#2A2A2A");if(b.A.levels.c==q){m.attr("id","cur")}if(h&&(q%3==2)){y=s.clone();y.text((b.A.max-(q+1)/3*10)+"°").move(15,r);m.append(y)}if(q==z-1&&b.A.label){y=s.clone();y.text(b.A.label);m.append(y.move(-10,10).turn(-60,0,0).attr({"font-size":"10px","font-style":"italic"}))}}E=s.clone();E.text(A).attr("text-anchor","end").turn(300,0,0).move(-8,10);m.append(E)};(function(){e(d,c)}())};var Chart=function(c,a){var b=function(f,q){var e,k,g=f[0].low,m=f[0].high;for(k=0;k<f.length;k++){g=M.min(g,f[k].low);m=M.max(m,f[k].high)}for(k=0;k<f.length;k++){e=f[k];e.off=k;e.min=g;e.max=m;if(k==f.length-1){e.axis=true}new Temp(e,k==0?q:null)}var j=x("r"),p=x(j.getElementsByTagName("rect")[0]),u=p.clone(),s=x("w"),g=x("cur"),n=s.getBBox(),d=n.width-(M.abs(n.x)+16+g._offset);console.log([d,n.width,n.x,16,g._offset]);g.append(x("p").move(-2,0)).prepend(j.move(-2,0));p.attr("width",d);j.append(u.move(d-0.1,0).attr({style:"fill:url(#gr)",width:40}));var v=x("txt").clone().text("Current Temp: "+f[0].mark+"°");j.append(v.move(d+20,6))};(function(){b(c,a)}())};var YQL={api:"http://api.wunderground.com/auto/wui/geo/ForecastXML/index.xml?query=",url:"http://query.yahooapis.com/v1/public/yql?format=json&q=",query:"select * from xml where url",forecast:function(a){var b=YQL.url+escape(YQL.query+'="'+YQL.api+escape(a)+'"');YQL._query(b,"YQL.forecastCB")},cities:function(a){var d=[];for(var c in a){d.push(YQL.api+escape(a[c]))}var b=YQL.url+escape(YQL.query+' in ("'+d.join('","')+'")');YQL._query(b,"YQL.citiesCB")},forecastCB:function(d){var a=d.query.results.forecast,c;var e=a.txt_forecast.forecastday[0].fcttext;a=a.simpleforecast.forecastday;var g=[];for(var b in a){c=a[b];g.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(g,e)},citiesCB:function(d){var a=d.query.results.forecast,e=[],c;for(var b in a){c=a[b].simpleforecast.forecastday[0];e.push(YQL._forecastCollector(c))}$(".wrapper").remove();new Chart(e,"text",{m:-1})},_forecastCollector:function(a){return{label:a.date.weekday,high:a.high.fahrenheit,low:a.low.fahrenheit}},_query:function(b,a){$.ajax({url:b,dataType:"jsonp",jsonp:"callback",jsonpCallback:a})}};