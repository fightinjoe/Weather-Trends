var M=Math,r=8.66;var R,W,G,T,TX,B;function glob(){R=x("r"),W=x("w"),G=x("g"),T=x("t"),TX=x("txt")}var xs={append:function(a){this.appendChild(a);return this},prepend:function(a){this.insertBefore(a,this.firstChild);return this},dad:function(){return x(this.parentNode)},clone:function(){var a=this.cloneNode(false),c=this.childNodes;a.id=null;a=x(a);for(var b=0;b<c.length;b++){a.append(x(c[b]).clone())}return a},attr:function(b,d){var c=["fill-opacity","filter"].indexOf(b)>-1;if(typeof b=="object"){for(var a in b){this.attr(a,b[a])}}else{if(arguments.length==2){this.setAttributeNS(null,b,d)}else{return this.getAttributeNS(null,b)}}return this},trans:function(b){var a=Array.prototype;t=(this.attr("transform")||"").replace(new RegExp(b+"\\(.*?\\)"),"");var c=t+" "+b+"("+a.join.call(a.slice.call(arguments,1)," ")+")";this.attr("transform",c);return this},move:function(a,b){return this.trans("translate",a,b)},turn:function(b,a,c){return this.trans("rotate",b,a,c)},bg:function(a){return this.attr("fill",a.toString())},text:function(a){this.appendChild(document.createTextNode(a));return this},empty:function(){var a=this.childNodes;while(a.length>0){this.removeChild(a[0])}},};var x=function(b){if(typeof b=="string"){return x(document.getElementById(b))}else{for(var a in xs){b[a]=xs[a]}return b}};var C=function(b){var a=this;this.A={hex:null,tpl:null};var c=function(d){if(d.hex){a.A.hex=d.hex;a.A.tpl=a.toTriplet()}if(d.tpl){a.A.tpl=d.tpl;a.A.hex=a.toString()}};this.gradient=function(j,d){var g=a.A.tpl,f=j.A.tpl,l;l=function(m){return(f[m]-g[m])/d};var k=[l(0),l(1),l(2)];var e=[a];l=function(n,m){return g[m]+(k[m]*n)};for(var h=0;h<d;h++){e.push(new C({tpl:[l(h,0),l(h,1),l(h,2)]}))}return e};this.toTriplet=function(){function d(e){return parseInt(a.A.hex.substr(e,2),16)}return[d(0),d(2),d(4)]};this.toString=function(){var d=a.A.tpl,e;function f(g){e=M.floor(d[g]).toString(16);return(("0"+e).substr(e.length-1,2))}return"#"+f(0)+f(1)+f(2)};(function(){c(b)}())};C.array=function(f,a){var h=new C({hex:f[0]}),b=[],g;for(var e=1;e<f.length;e++){if(g){h=g}g=new C({hex:f[e]});b=b.concat(h.gradient(g,a-1))}b.push(g);return b};C.bw=["#000","#2A2A2A"];var _GRADIENTS=C.array(["000000","9363F6","FFFFFF","2CE7FC","FEFB60","FF001A","8C0009"],12);var Temp=function(d,c){var b=this;b.A={o:1};var e=function(i,h){b.A.opts=i;b.A.low=f(i.low,-1);b.A.high=f(i.high,1);if(i.mark){b.A.cur=f(i.mark,1)}var g=f(i.min||i.low,-1,10);var j=f(i.max||i.high,1,10);while(j-g<40){j>=100?g=g-10:j=j+10}b.A.off=(i.off||0)*16;b.A.levels={d:(j-g)/10*3,h:(j-b.A.high)/10*6,l:(j-b.A.low)/10*6-1};if(i.mark){b.A.levels.c=M.floor((j-b.A.cur)/10*3)}b.A.label=h;b.A.min=g;b.A.max=j;b.A.cI=(g)*0.6+16;a(i.label,i.axis)};var f=function(i,g,h){h=h||10/6;i=i/h;return(g>0?M.ceil(i):M.floor(i))*h};var a=function(z,l){var D=G.clone();W.append(D);if(b.A.off){D.move(b.A.off,0)}D._offset=b.A.off;D._forecast="high "+b.A.opts.high+"\u00B0, low "+b.A.opts.low+"\u00B0";var s=G.clone(),n=T.clone().move(5,0).turn(180,5,r/2),y=T.clone(),E=b.A.levels,A=E.d,q,w,p,m,h,o;s.append(n).append(y);for(var u=0;u<A;u++){h=s.clone();D.append(h);h._offset=(A-u-1)*5;h.move(h._offset,r*u);q=A-2*u+b.A.cI;for(p=0;p<2;p++){o=(E.h<=u*2+p&&u*2+p<=E.l);h.childNodes[p].bg(o?_GRADIENTS[q-p]:C.bw[p]);if(!o){h.childNodes[p].attr("class","black")}}if(b.A.levels.c==u){h.attr("id","cur")}if(l&&(u%3==2)){w=TX.clone();w.text((b.A.max-(u+1)/3*10)+"\u00B0").move(15,r);h.append(w)}if(u==A-1&&b.A.label){w=TX.clone();w.text(b.A.label);h.append(w.move(-10,10).turn(-60,0,0).attr({"font-size":"10px","font-style":"italic"}))}}var v=D.clone();W.prepend(v);D.attr("class","temp");tx=TX.clone();tx.text(z).attr("text-anchor","end").turn(300,0,0).move(-8,10);h.append(tx)};(function(){e(d,c)}())};var chart=function(q,k){var u,z,w=q[0].low,A=q[0].high;for(z=0;z<q.length;z++){w=M.min(w,q[z].low);A=M.max(A,q[z].high)}for(z=0;z<q.length;z++){u=q[z];u.off=z;u.min=w;u.max=A;if(z==q.length-1){u.axis=true}new Temp(u,z==0?k:null)}var m=R.clone(),s=x(m.firstChild),d=x(m.childNodes[1]),g=d.clone(),c=x("cur"),e=W.getBBox(),v=e.width-(M.abs(e.x)-16+c._offset);s.attr("transform","scale(0.8)");m.attr("transform","scale(0.8)");c.append(s.move(-2,1)).prepend(m.move(-2,1));d.attr("width",v);m.append(g.move(v-0.2,0).attr({style:"fill:url(#gr)",width:40}));var n=TX.clone().text("currently "+q[0].mark+"\u00B0");m.append(n.move(v+20,7).attr({"font-size":"10","font-style":"italic"}));var b=document.getElementsByClassName("temp"),f;for(var z=0;z<b.length;z++){f=b[z].getElementsByClassName("black");for(var y=0;y<f.length;y++){x(f[y]).attr("style","display:none")}}var D=x(c.parentNode),a=TX.clone().text(D._forecast);m.append(a.move(m.getBBox().width-4,14).attr("fill","Gray").attr("text-anchor","end"))};var YQL={api:"http://api.wunderground.com/auto/wui/geo/",svcF:"ForecastXML",svcC:"WXCurrentObXML",url:"http://query.yahooapis.com/v1/public/yql?diagnostics=true&format=json&q=",query:"select * from xml where url",forecast:function(a){var d=YQL.api+YQL.svcF+"/index.xml?query="+escape(a),c=d.replace(YQL.svcF,YQL.svcC);var b=YQL.url+escape(YQL.query+' in("'+[d,c].join('","')+'")');YQL._query(b,"svg.YQL.forecastCB")},forecastCB:function(e){var c=e.query.results,a=c.forecast,h=c.current_observation,d;var g=unescape(e.query.diagnostics.url[0].content).split("=")[1].titleCase();a=a.simpleforecast.forecastday;var j=[];for(var b in a){d=a[b];j.push(YQL._forecastCollector(d))}j[0].mark=parseInt(h.temp_f);W.empty();PW.set("w",g);chart(j,g);PW.$(".show").removeClass("show")},_forecastCollector:function(a){return{label:a.date.weekday,high:a.high.fahrenheit,low:a.low.fahrenheit}},_query:function(b,a){$.ajax({url:b,dataType:"jsonp",jsonp:"callback",jsonpCallback:a})}};String.prototype.titleCase=function(){var b=this.split(" ");for(var a in b){b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1).toLowerCase()}return b.join(" ")};